<?phpnamespace App\Http\Controllers;use App\Models\DailyLoan;use App\Models\DailySavings;use App\Models\Dps;use App\Models\DpsLoan;use App\Models\Fdr;use App\Models\SpecialDps;use App\Models\SpecialDpsLoan;use Illuminate\Http\Request;class DashboardController extends Controller{  // Dashboard - Analytics  public function __construct()  {    $this->middleware('auth');  }  public function index()  {    $data = [];    // Single query to calculate totals for all data    $dailySavings = DailySavings::selectRaw('SUM(deposit) as total_deposit, SUM(withdraw) as total_withdraw, SUM(profit) as total_profit, SUM(balance) as total_remain')->first();    $monthlySavings = Dps::selectRaw('SUM(deposited) as total_deposit, SUM(withdraw) as total_withdraw, SUM(profit) as total_profit, SUM(balance) as total_remain')->first();    $specialSavings = SpecialDps::selectRaw('SUM(deposited) as total_deposit, SUM(withdraw) as total_withdraw, SUM(profit) as total_profit, SUM(balance) as total_remain')->first();    $fdr = Fdr::selectRaw('SUM(amount) as total_deposit, SUM(balance) as total_remain, SUM(profit) as total_profit')->first();    $dailyLoans = DailyLoan::selectRaw('SUM(loan_amount) as loan_amount, SUM(total) as total,SUM(balance) as loan_remain, SUM(paid_interest) as paid_interest')->first();    $dpsLoans = DpsLoan::selectRaw('SUM(loan_amount) as loan_amount,SUM(remain_loan) as loan_remain, SUM(paid_interest) as paid_interest, SUM(total_paid) as loan_return')->first();    $specialDpsLoans = SpecialDpsLoan::selectRaw('SUM(loan_amount) as loan_amount, SUM(remain_loan) as loan_remain, SUM(paid_interest) as paid_interest, SUM(total_paid) as loan_return')->first();    $dailyLoanReturn = $dailyLoans->total - $dailyLoans->loan_remain - $dailyLoans->paid_interest;    $data['totalDeposit'] = $dailySavings->total_deposit + $monthlySavings->total_deposit + $specialSavings->total_deposit;    $data['totalWithdraw'] = $dailySavings->total_withdraw + $monthlySavings->total_withdraw + $specialSavings->total_withdraw;    $data['totalProfit'] = $dailySavings->total_profit + $monthlySavings->total_profit + $specialSavings->total_profit;    $data['totalRemainSavings'] = $dailySavings->total_remain + $monthlySavings->total_remain + $specialSavings->total_remain;    $data['total_loan'] = $dailyLoans->loan_amount + $dpsLoans->loan_amount + $specialDpsLoans->loan_amount;    $data['total_loan_return'] = $dailyLoanReturn + $dpsLoans->loan_return + $specialDpsLoans->loan_return;    $data['daily_loan'] = $dailyLoans->loan_amount;    $data['daily_loan_return'] = $dailyLoanReturn;    $data['monthly_loan'] = $dpsLoans->loan_amount;    $data['monthly_loan_return'] = $dpsLoans->loan_return;    $data['special_loan'] = $specialDpsLoans->loan_amount;    $data['special_loan_return'] = $specialDpsLoans->loan_return;    $data['fdr_profit_withdraw'] = $fdr->total_profit;    $data['daily_savings_remain'] = $dailySavings->total_remain;    $data['monthly_savings_remain'] = $monthlySavings->total_remain;    $data['special_savings_remain'] = $specialSavings->total_remain;    $data['fdr_savings_remain'] = $fdr->total_remain;    return view('dashboard',compact('data'));  }  public function dashboardAnalytics()  {    $pageConfigs = ['pageHeader' => false];    return view('content.dashboard.dashboard-analytics', ['pageConfigs' => $pageConfigs]);  }  // Dashboard - Ecommerce  public function dashboardEcommerce()  {    $pageConfigs = ['pageHeader' => false];    return view('content.dashboard.dashboard-ecommerce', ['pageConfigs' => $pageConfigs]);  }  public function send_sms($ac , $dps,$deposited, $mobile, $loan,$due)  {    /*$url  = "http://portal.greenheritageit.com/smspanel/smsapi";    $data = [        "api_key"  => "2y10idNcUXn2CcHWl2XPcmIUoOS6Pk3x2sWssk3d8CZn6jUiiO7nYgnVG750",        "type"     => "text",        "contacts" => "$mobile",        "senderid" => "8809612440620",        "msg"      => "Ur payment ".$dps." has been received. Balance: A/c no : ".$ac.",Deposit ".$deposited.",Loan ".$loan.",Due ".$due.".Thanks for staying with us. visit: www.freedomsssl.com",    ];    $ch   = curl_init();    curl_setopt($ch, CURLOPT_URL, $url);    curl_setopt($ch, CURLOPT_POST, 1);    curl_setopt($ch, CURLOPT_POSTFIELDS, $data);    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);    $response = curl_exec($ch);    curl_close($ch);    return $response;*/  }  public function installment()  {    return view('app.installment');  }}